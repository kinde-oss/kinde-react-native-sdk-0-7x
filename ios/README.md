# iOS Sample App (KindeSDKRN)

This folder contains a sample React Native iOS app that demonstrates the Kinde SDK with `react-native-app-auth`.

---

## Quick Start (TL;DR)

```bash
# From repo root
npm install

# iOS native dependencies
cd ios
rbenv install 3.2.2          # if not already installed
rbenv local 3.2.2
gem install bundler -v 2.4.10
bundle _2.4.10_ install
bundle exec pod install
cd ..

# Run
npx react-native start       # Terminal 1: Metro bundler
# Then build & run from Xcode (see below)
```

---

## Prerequisites

| Tool              | Notes                                                                   |
| ----------------- | ----------------------------------------------------------------------- |
| **Node.js + npm** | LTS recommended                                                         |
| **Xcode**         | With iOS Simulator and Command Line Tools                               |
| **rbenv**         | Recommended for managing Ruby versions (avoids system Ruby on macOS)    |

### Install rbenv (one-time)

```bash
brew install rbenv ruby-build
```

Then add rbenv to your shell. Run `rbenv init` and follow the instructions, then **restart your terminal**.

---

## Step-by-Step Setup

### 1. Clone and install JS dependencies

```bash
git clone https://github.com/kinde-oss/kinde-react-native-sdk-0-7x.git
cd kinde-react-native-sdk-0-7x
npm install
```

### 2. Set up Ruby and CocoaPods

This project pins Ruby 3.2.2 and Bundler 2.4.10 for reproducible builds.

```bash
cd ios

# Install and use the pinned Ruby version
rbenv install 3.2.2    # skip if already installed
rbenv local 3.2.2

# Verify you're using rbenv Ruby (NOT system Ruby)
which ruby       # should show ~/.rbenv/shims/ruby
ruby -v          # should show 3.2.2

# Install Bundler and gems
gem install bundler -v 2.4.10
bundle _2.4.10_ install

# Install CocoaPods dependencies
bundle exec pod install
```

> ⚠️ **Always run CocoaPods through Bundler:** `bundle exec pod install`

### 3. Configure Kinde credentials

Edit `ios/App.tsx` and update the `kindeConfig` object with your Kinde application details:

```typescript
const kindeConfig = {
    domain: 'https://YOUR_SUBDOMAIN.kinde.com',
    clientId: 'YOUR_CLIENT_ID',
    redirectUri: 'com.kindesdkrn://kinde_callback',
    logoutRedirectUri: 'com.kindesdkrn://kinde_logout',
    scope: 'openid profile email offline'
};
```

In your [Kinde dashboard](https://app.kinde.com), add these **Allowed callback URLs**:

-   `com.kindesdkrn://kinde_callback`
-   `com.kindesdkrn://kinde_logout`

### 4. Start Metro bundler

From the **repo root**:

```bash
npx react-native start
```

Keep this terminal running.

### 5. Build and run in Xcode

1. Open **`ios/KindeSDKRN.xcworkspace`** in Xcode (NOT `.xcodeproj`)
2. Select scheme: **KindeSDKRN**
3. Select a simulator (e.g., iPhone 15 Pro)
4. Press **⌘R** to build and run

---

## Troubleshooting

### "Library 'AppAuth' not found" or linker errors

You likely opened `.xcodeproj` instead of `.xcworkspace`, or Pods are out of sync.

```bash
# Close Xcode first, then:
rm -rf ~/Library/Developer/Xcode/DerivedData/KindeSDKRN-*
cd ios
bundle exec pod install
# Reopen ios/KindeSDKRN.xcworkspace
```

### Using wrong Ruby (system Ruby errors)

If you see errors referencing `/System/Library/Frameworks/Ruby.framework/` or `/usr/bin/bundle`:

```bash
# Check which Ruby you're using
which ruby && ruby -v
which bundle && bundle -v

# Should show rbenv paths like:
# /Users/you/.rbenv/shims/ruby
# ruby 3.2.2
```

If not, ensure rbenv is initialized in your shell config (`.zshrc` or `.bashrc`).

### Metro bundler issues

If you see errors like `"Property 'require' doesn't exist"` or module resolution errors:

```bash
# Reset Metro cache
npx react-native start --reset-cache
```

### Pods won't install / boost download fails

Some networks block `boostorg.jfrog.io`. The Podfile includes a workaround that uses `archives.boost.io` instead. If you still have issues:

```bash
cd ios
bundle exec pod cache clean --all
bundle exec pod install
```

---

## Project Structure

```text
ios/
├── App.tsx                  # Sample app UI (configure Kinde here)
├── index.js                 # Entry point
├── Podfile                  # CocoaPods dependencies
├── Gemfile                  # Ruby/Bundler dependencies
├── .ruby-version            # Pinned Ruby version (3.2.2)
├── KindeSDKRN/
│   ├── AppDelegate.h/m      # iOS app delegate (handles OAuth redirects)
│   └── Info.plist           # URL schemes for deep linking
└── KindeSDKRN.xcworkspace   # ← Open this in Xcode
```

---

## Notes

-   **Always open `.xcworkspace`**, not `.xcodeproj`. The workspace includes CocoaPods-managed dependencies.
-   **`ios/Pods/`** is generated by CocoaPods and git-ignored.
-   **Deployment target** is iOS 12.4+.
-   The sample uses `react-native-app-auth` for OAuth, which requires the `RNAppAuthAuthorizationFlowManager` protocol in `AppDelegate`.
